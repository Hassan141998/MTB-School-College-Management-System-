{% extends 'base.html' %}
{% block title %}Face Mark Attendance â€” MTB School{% endblock %}
{% block body_attr %}data-face-mode="mark"{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='js/face-recognition.js') }}"></script>{% endblock %}
{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <div>
            <h1 class="page-title">ğŸ“¸ Face Attendance</h1>
            <p class="page-subtitle">Capture a photo to auto-mark attendance</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('face.register') }}" class="btn btn-outline">ğŸ¤– Register Faces</a>
            <a href="{{ url_for('face.live') }}" class="btn btn-secondary">ğŸ“¡ Live Mode</a>
        </div>
    </div>

    {% if not available %}
    <div class="face-unavailable">
        <div class="icon">ğŸ› ï¸</div>
        <h3>Face Recognition Not Available</h3>
        <p>Install <code>face-recognition</code> and <code>opencv-python-headless</code> to use this feature.</p>
    </div>
    {% else %}
    <div class="camera-section">
        <div class="camera-card">
            <div class="camera-header"><span class="camera-title">ğŸ“· Camera</span>
                <div class="camera-status">
                    <div class="status-dot"></div><span>Camera Off</span>
                </div>
            </div>
            <div class="camera-feed-wrapper">
                <video id="camera-video" autoplay muted playsinline></video>
                <canvas id="camera-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%"></canvas>
                <div class="camera-placeholder">
                    <div class="camera-placeholder-icon">ğŸ“·</div>
                    <div class="camera-placeholder-text">Click "Start Camera"</div>
                </div>
            </div>
            <div class="camera-footer">
                <button class="btn btn-primary" id="start-camera-btn">â–¶ Start Camera</button>
                <button class="btn btn-outline" id="stop-camera-btn" style="display:none">â¹ Stop</button>
                <button class="btn btn-accent" id="recognize-btn" disabled>ğŸ“¸ Capture & Recognize</button>
            </div>
        </div>
        <div class="face-panel">
            <div class="face-panel-header">Recognition Results</div>
            <div id="recognition-results" style="min-height:200px">
                <div class="empty-state" style="padding:40px">
                    <div class="empty-state-icon">ğŸ”</div>
                    <div>Click capture to recognize faces</div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}