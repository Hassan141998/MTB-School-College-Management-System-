{% extends 'base.html' %}
{% block title %}Record Payment ‚Äî MTB School{% endblock %}
{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <div>
            <h1 class="page-title">Record Fee Payment</h1>
        </div>
        <a href="{{ url_for('fees.payments') }}" class="btn btn-outline">‚Üê Back</a>
    </div>
    <div class="grid-2">
        <div>
            <form method="POST" action="{{ url_for('fees.record_payment') }}">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üí∞ Payment Details</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Student <span class="req">*</span></label>
                            <select name="student_id" id="student-select" class="form-control" required>
                                <option value="">Select Student</option>
                                {% for s in students %}<option value="{{ s.id }}">{{ s.full_name }} ‚Äî {{ s.reg_no }}
                                </option>{% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fee Type</label>
                            <select name="fee_structure_id" id="fee-structure-select" class="form-control">
                                <option value="">Select (optional)</option>
                                {% for fs in fee_structures %}<option value="{{ fs.id }}" data-amount="{{ fs.amount }}">
                                    {{ fs.name }} ‚Äî PKR {{ "{:,.0f}".format(fs.amount) }}</option>{% endfor %}
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Month</label>
                                <select name="month" class="form-control">
                                    <option value="">Select</option>
                                    {% for m in months %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <select name="year" class="form-control">
                                    {% for yr in years %}<option value="{{ yr }}" {% if yr==today.year %}selected{%
                                        endif %}>{{ yr }}</option>{% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Amount (PKR) <span class="req">*</span></label>
                                <input type="number" name="amount" id="amount-input" class="form-control" required
                                    placeholder="0" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Discount</label>
                                <input type="number" name="discount" id="discount-input" class="form-control"
                                    placeholder="0" min="0" step="1" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Late Fine</label>
                                <input type="number" name="fine" id="fine-input" class="form-control" placeholder="0"
                                    min="0" step="1" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Method</label>
                                <select name="payment_method" class="form-control">
                                    <option value="cash">Cash</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="online">Online</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Payment Date</label>
                                <input type="date" name="payment_date" class="form-control"
                                    value="{{ today.isoformat() }}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bank Reference</label>
                                <input type="text" name="bank_reference" class="form-control" placeholder="Optional">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea name="notes" class="form-control" rows="2"
                                placeholder="Any additional notes..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body" style="display:flex;align-items:center;justify-content:space-between">
                        <div>
                            <div style="font-size:12px;color:var(--text-muted)">Total to Pay</div>
                            <div id="total-display" style="font-size:24px;font-weight:800;color:var(--primary)">PKR 0
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg">üíæ Record Payment</button>
                    </div>
                </div>
            </form>
        </div>
        <div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚ÑπÔ∏è Fee Structure Reference</div>
                </div>
                <div class="card-body" style="padding:0">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Amount</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for fs in fee_structures %}
                            <tr>
                                <td>{{ fs.name }}</td>
                                <td>{{ fs.class_name or 'All' }}</td>
                                <td>PKR {{ "{:,.0f}".format(fs.amount) }}</td>
                                <td><span class="badge badge-secondary">{{ fs.fee_type }}</span></td>
                            </tr>
                            {% else %}<tr>
                                <td colspan="4" class="text-muted" style="text-align:center;padding:20px">No fee
                                    structures configured</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}