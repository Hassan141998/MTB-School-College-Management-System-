{% extends 'base.html' %}
{% block title %}Students â€” MTB School{% endblock %}
{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <div>
            <h1 class="page-title">Students</h1>
            <p class="page-subtitle">Manage all student records</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('students.export_students') }}" class="btn btn-outline">ğŸ“¥ Export Excel</a>
            <a href="{{ url_for('students.add_student') }}" class="btn btn-primary">+ Add Student</a>
        </div>
    </div>

    <!-- Filter Bar -->
    <form method="GET" class="filter-bar">
        <div class="input-group" style="flex:1;min-width:220px">
            <span class="input-icon">ğŸ”</span>
            <input type="text" name="search" value="{{ search }}" class="form-control"
                placeholder="Search by name, reg no...">
        </div>
        <select name="class_id" class="form-control" style="width:180px">
            <option value="">All Classes</option>
            {% for cls in classes %}
            <option value="{{ cls.id }}" {% if class_id==cls.id|string %}selected{% endif %}>{{ cls.display_name }}
            </option>
            {% endfor %}
        </select>
        <select name="status" class="form-control" style="width:140px">
            <option value="active" {% if status=='active' %}selected{% endif %}>Active</option>
            <option value="inactive" {% if status=='inactive' %}selected{% endif %}>Inactive</option>
            <option value="" {% if not status %}selected{% endif %}>All Status</option>
        </select>
        <button type="submit" class="btn btn-secondary">Filter</button>
        <a href="{{ url_for('students.list_students') }}" class="btn btn-outline">Reset</a>
    </form>

    {% if students %}
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Reg No</th>
                    <th>Student</th>
                    <th>Father's Name</th>
                    <th>Class</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for s in students %}
                <tr>
                    <td class="text-muted">{{ loop.index }}</td>
                    <td><span class="reg-no">{{ s.reg_no }}</span></td>
                    <td>
                        <div class="avatar-cell">
                            <div class="cell-avatar">
                                {% if s.photo %}<img src="{{ url_for('static', filename=s.photo) }}" alt="">{% else %}{{
                                s.full_name[0]|upper }}{% endif %}
                            </div>
                            <div>
                                <div class="cell-name">{{ s.full_name }}</div>
                                <div class="cell-sub">{{ s.gender or 'â€”' }} Â· {{ s.blood_group or 'â€”' }}</div>
                            </div>
                        </div>
                    </td>
                    <td>{{ s.father_name or 'â€”' }}</td>
                    <td>{% if s.class_section %}<span class="badge badge-secondary">{{ s.class_section.display_name
                            }}</span>{% else %}â€”{% endif %}</td>
                    <td>{{ s.phone or s.parent_phone or 'â€”' }}</td>
                    <td><span
                            class="badge {% if s.status == 'active' %}badge-success{% elif s.status == 'inactive' %}badge-danger{% else %}badge-gray{% endif %}">{{
                            s.status|capitalize }}</span></td>
                    <td>
                        <div class="actions">
                            <a href="{{ url_for('students.view_student', id=s.id) }}" class="action-btn view"
                                data-tooltip="View">ğŸ‘</a>
                            <a href="{{ url_for('students.edit_student', id=s.id) }}" class="action-btn edit"
                                data-tooltip="Edit">âœï¸</a>
                            <form method="POST" action="{{ url_for('students.delete_student', id=s.id) }}"
                                data-confirm="Deactivate this student?" style="display:inline">
                                <button type="submit" class="action-btn delete" data-tooltip="Deactivate">ğŸ—‘</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if pagination.pages > 1 %}
    <ul class="pagination">
        <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
            <a class="page-link"
                href="{{ url_for('students.list_students', page=pagination.prev_num, search=search, class_id=class_id, status=status) }}">â€¹</a>
        </li>
        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
        <li class="page-item {% if p == pagination.page %}active{% endif %}">
            <a class="page-link"
                href="{{ url_for('students.list_students', page=p, search=search, class_id=class_id, status=status) }}">{{
                p }}</a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
        {% endif %}
        {% endfor %}
        <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
            <a class="page-link"
                href="{{ url_for('students.list_students', page=pagination.next_num, search=search, class_id=class_id, status=status) }}">â€º</a>
        </li>
    </ul>
    {% endif %}

    {% else %}
    <div class="card">
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <div class="empty-state-title">No students found</div>
            <div class="empty-state-subtitle">Try adjusting your filters or <a
                    href="{{ url_for('students.add_student') }}" style="color:var(--primary)">add a new student</a>.
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}