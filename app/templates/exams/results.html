{% extends 'base.html' %}
{% block title %}Exam Results â€” MTB School{% endblock %}
{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <div>
            <h1 class="page-title">Results: {{ exam.name }}</h1>
            <p class="page-subtitle">{{ exam.class_section.display_name if exam.class_section else 'All Classes' }} Â· {{
                exam.academic_year }}</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('exams.enter_marks', exam_id=exam.id) }}" class="btn btn-secondary">âœï¸ Enter Marks</a>
            <a href="{{ url_for('exams.list_exams') }}" class="btn btn-outline">â† Exams</a>
        </div>
    </div>

    <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:24px">
        <div class="stat-card green">
            <div class="stat-icon">ğŸ†</div>
            <div class="stat-info">
                <div class="stat-value">{{ result_summary.passed }}</div>
                <div class="stat-label">Passed</div>
            </div>
        </div>
        <div class="stat-card orange">
            <div class="stat-icon">âŒ</div>
            <div class="stat-info">
                <div class="stat-value">{{ result_summary.failed }}</div>
                <div class="stat-label">Failed</div>
            </div>
        </div>
        <div class="stat-card blue">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-info">
                <div class="stat-value">{{ result_summary.avg_pct }}%</div>
                <div class="stat-label">Class Average</div>
            </div>
        </div>
        <div class="stat-card gold">
            <div class="stat-icon">â­</div>
            <div class="stat-info">
                <div class="stat-value">{{ result_summary.top_pct }}%</div>
                <div class="stat-label">Top Score</div>
            </div>
        </div>
    </div>

    {% if results %}
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Reg No</th>
                    <th>Student</th>{% for sub in subjects %}<th>{{ sub.name }}</th>{% endfor %}<th>Total</th>
                    <th>%</th>
                    <th>Grade</th>
                    <th>Status</th>
                    <th>PDF</th>
                </tr>
            </thead>
            <tbody>
                {% for r in results %}
                <tr>
                    <td><strong>{{ loop.index }}</strong></td>
                    <td><span class="reg-no">{{ r.student.reg_no }}</span></td>
                    <td class="cell-name">{{ r.student.full_name }}</td>
                    {% for sub in subjects %}
                    <td>{{ r.marks.get(sub.id, {}).obtained_marks if r.marks.get(sub.id) else 'â€”' }}</td>
                    {% endfor %}
                    <td><strong>{{ r.total_obtained }}</strong>/{{ r.total_marks }}</td>
                    <td><strong>{{ r.percentage }}%</strong></td>
                    <td><span class="grade-badge grade-{{ r.grade|replace('+','plus') }}">{{ r.grade }}</span></td>
                    <td><span class="badge {% if r.status == 'Pass' %}badge-success{% else %}badge-danger{% endif %}">{{
                            r.status }}</span></td>
                    <td><a href="{{ url_for('exams.download_result_card', exam_id=exam.id, student_id=r.student.id) }}"
                            class="action-btn pdf" target="_blank" data-tooltip="Result Card">ğŸ“„</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="card">
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ“Š</div>
            <div class="empty-state-title">No marks entered yet</div><a
                href="{{ url_for('exams.enter_marks', exam_id=exam.id) }}" class="btn btn-primary mt-3">Enter Marks</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}